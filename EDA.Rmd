---
title: "EDA"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


### EDA

## Data source
https://www.kaggle.com/shivamb/netflix-shows
## Data in 
```{r, eval = FALSE}
unzip("netflix-shows.zip")
```

```{r}
library(data.table)
library(ggplot2)
data_in <- data.table(read.csv("netflix_titles.csv", 
                               stringsAsFactors = FALSE))

# most of the obs of a data scientist - dealing with inconsistent / dirty 
# data
data_in[, date_added := gsub(", ", ",", date_added)]
data_in[, date_added := gsub("^ ", "", date_added)]
data_in[date_added == "", 
        date_added := paste0("January 01,", release_year)]

data_in[, date_added := as.Date(date_added, format = "%B %d,%Y")]
```

- Ratings

```{r}
ggplot(data_in, aes(x = rating)) +
  geom_histogram(stat = "count") +
  ggtitle("Histogram of ratings")
# todo: Need to have a look at the different types of ratings
```
```{r}
library(dplyr)
library(tidyr)

countries <- data_in %>% 
  mutate(symbols = strsplit(country, " ,")) %>%
  unnest(symbols) %>%
  mutate(symbols = strsplit(symbols, ",")) %>%
  unnest(symbols) %>%
  data.table()

countries[, symbols := gsub("^ ", "", symbols),]

```

```{r}

titles_by_countries <- countries[, .(title, symbols)]

counted_titles_per_country <- titles_by_countries[, .(counts = .N), .(symbols)]
setorder(counted_titles_per_country,-counts)

View(counted_titles_per_country)

counted_titles_per_country %>%
  top_n(15) %>%
  ggplot(aes(x = symbols, y = counts)) +
  geom_point()

```

Quite a lot of movies are produced / created in the United States. That makes 
sense from the point of view that the Western / Hollywood culture has been 
overtaking everything. On the other hand, we are talking a three times more
movies produces in the States than in the second most popular country - India.
It would be interesting to compare this to the countries of the viewers of 
Netflix.

- most popular actors as defined by how many titles they are in
```{r}
head(data_in)

actors <- data_in %>% 
  mutate(cast = strsplit(cast, " ,")) %>%
  unnest(cast) %>%
  mutate(cast = strsplit(cast, ",")) %>%
  unnest(cast) %>%
  data.table()

actors[, cast := gsub("^ ", "", cast),]

titles_by_actors <- actors[, .(title, cast)]

counted_titles_per_actor <- titles_by_actors[, .(counts = .N), .(cast)]
setorder(counted_titles_per_actor,-counts)

View(counted_titles_per_actor)

counted_titles_per_actor %>%
  top_n(10) %>%
  ggplot(aes(x = cast, y = counts)) +
  geom_point()

```
Lots of what I assume are Indian names.


- is there a good last name for an actor?
```{r}
library(tidytext)
counted_titles_per_actor[, id := 1:.N]
tokenized <- counted_titles_per_actor %>%
  unnest_tokens(word, cast)

tokenized %>%
  group_by(id) %>%
  count(id) %>%
  
tokenized[, number_o]

counted_titles_per_actor[, .(last_name = grep("", cast, value = TRUE))]
```


- most popular directors as defined by how many things they have directed + 
how many other directors were in it

```{r}
actors <- data_in %>% 
  mutate(cast = strsplit(cast, " ,")) %>%
  unnest(cast) %>%
  mutate(cast = strsplit(cast, ",")) %>%
  unnest(cast) %>%
  data.table()

actors[, cast := gsub("^ ", "", cast),]

titles_by_actors <- actors[, .(title, cast)]

counted_titles_per_actor <- titles_by_actors[, .(counts = .N), .(cast)]
setorder(counted_titles_per_actor,-counts)

View(counted_titles_per_actor)

counted_titles_per_actor %>%
  top_n(10) %>%
  ggplot(aes(x = cast, y = counts)) +
  geom_point()

```


- maps by country
- average number of actors quoted per title
- number of reviews per country
- do we have only one id per row?
- do we have duplicate names? 
- common bigrams / trigrams
- inverse frequency on the description
- count of characters in the description
- most popular groups
- most niche groups - the shows in them are not listed in many more groups on 
average
- how does the distribution of movies change over time - movies produced in 
different countries added in 

- TV shows against movies over time
```{r}
# something sketchy happening here
counts_type <- data_in[, .N, .(type, date_added)]
max(counts_type$N)
counts_type[, quarter := zoo::as.yearqtr(date_added)]
counts_type <- counts_type[, .(N = sum(N)), .(type, quarter)]
max(counts_type$N)
ggplot(counts_type, aes(x = quarter, y = N, col = type))+
  geom_line() +
  ggtitle("Additions of shows and movies by quarter")
```

Zipf's Law ------------------------
Zipfâ€™s law states that the frequency that a word appears is inversely 
proportional to its rank.
